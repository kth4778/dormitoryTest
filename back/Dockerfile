# âœ… 1ë‹¨ê³„: Gradleë¡œ ë¹Œë“œ (ë¹Œë” ìŠ¤í…Œì´ì§€)
FROM gradle:7.6.0-jdk17 AS builder
WORKDIR /home/gradle/project

# ğŸ”§ [1] build.gradle, settings.gradleì´ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì‹¤ì œë¡œ ìˆëŠ”ì§€ í™•ì¸
# ì—†ê±°ë‚˜ ì´ë¦„ì´ ë‹¤ë¥´ë©´ COPY ì‹¤íŒ¨í•¨
COPY back/build.gradle .
COPY back/settings.gradle .
COPY back/gradle gradle
COPY back/src src
                   # ğŸ”§ src ë””ë ‰í† ë¦¬ê°€ /srcì— ìˆëŠ”ì§€ í™•ì¸

# ğŸ”§ [2] í•„ìš”í•œ ê²½ìš° --stacktrace ì˜µì…˜ ì¶”ê°€í•´ ë””ë²„ê¹… ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ
RUN gradle build --no-daemon --stacktrace

# âœ… 2ë‹¨ê³„: ì‹¤ì œ ì‹¤í–‰ í™˜ê²½
FROM openjdk:17-jdk-slim
WORKDIR /app

# ğŸ”§ [3] ìƒì„±ëœ JAR íŒŒì¼ ì´ë¦„ì´ app.jarë¡œ ê³ ì •ë¨
# JAR íŒŒì¼ ì´ë¦„ì´ ì˜ˆ: back-0.0.1-SNAPSHOT.jar ì´ë¼ë©´, ì§ì ‘ íŒŒì¼ëª…ì„ ë„£ì–´ë„ ë¨
COPY --from=builder /home/gradle/project/build/libs/*.jar app.jar

# ì‹¤í–‰ ëª…ë ¹
ENTRYPOINT ["java", "-jar", "app.jar"]
